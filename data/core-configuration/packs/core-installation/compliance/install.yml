compliance:
   name    : Install OpsBro system dependencies
   mode    : enforcing
   interval: 1s
   note    : This will install system prereqs about opsbro
   rule    :
      type        : package-install
      # You can set variables in order to not repeat yourself in the if rules
      variables   :
         is_debian            : "{{collector.system.os.linux.distribution}} == 'debian'"
         is_centos            : "{{collector.system.os.linux.distribution}} == 'centos'"
         is_rocky             : "{{collector.system.os.linux.distribution}} == 'rocky-linux'"
         is_alma         : "{{collector.system.os.linux.distribution}} == 'almalinux'"
         is_fedora            : "{{collector.system.os.linux.distribution}} == 'fedora'"
         is_alpine            : "{{collector.system.os.linux.distribution}} == 'alpine'"
         is_alpine_11         : "{{collector.system.os.linux.distribution}} == 'alpine' and {{collector.system.os.linux.minor_version}} == 11"   # TODO: in order to avoid the 2*and limitation in variables
         is_alpine_12_and_more: "{{collector.system.os.linux.distribution}} == 'alpine' and {{collector.system.os.linux.minor_version}} >= 12"   # TODO: in order to avoid the 2*and limitation in variables
         is_ubuntu            : "{{collector.system.os.linux.distribution}} == 'ubuntu'"
         is_amazon_linux      : "{{collector.system.os.linux.distribution}} == 'amazon-linux'"
         is_amazon_linux2     : "{{collector.system.os.linux.distribution}} == 'amazon-linux2'"
         is_amazon_linux2022  : "{{collector.system.os.linux.distribution}} == 'amazon-linux2022'"
         is_redhat            : "{{collector.system.os.linux.distribution}} == 'redhat'"
         is_oracle_linux      : "{{collector.system.os.linux.distribution}} == 'oracle-linux'"
         is_opensuse          : "{{collector.system.os.linux.distribution}} == 'opensuse'"
      environments:
         ###### CENTOS
         -  name      : centos6
            if        : "{{variables.is_centos}} and {{collector.system.os.linux.major_version}} == 6"
            parameters:
               packages:
                  - libgomp   # monotonic clock
                  - nss  # for epel https
                  - leveldb
                  - epel-release
                  - python-jinja2
                  - python-crypto
                  - python-simplejson
                  - python-setproctitle
                  - python-psutil
                  - python-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         -  name      : centos7_python2
            if        : "({{variables.is_centos}} and {{collector.system.os.linux.major_version}} == 7) and system_is_python_2()"
            parameters:
               packages:
                  - libgomp   # monotonic clock
                  - nss  # for epel https
                  - epel-release
                  - rpm-python
                  - python-jinja2
                  - python-crypto
                  - python2-leveldb   # currently disabled before we change tests to give leveldb by default every where
                  - python2-simplejson
                  - python-setproctitle
                  - python2-psutil
                  - python2-pyyaml
                  # Bash completion to enable the CLI completion
                  - bash-completion
         
         
         -  name      : centos7_python3
            if        : "({{variables.is_centos}} and {{collector.system.os.linux.major_version}} == 7) and system_is_python_3()"
            parameters:
               packages:
                  - libgomp   # monotonic clock
                  - nss  # for epel https
                  - epel-release
                  - python36-rpm
                  - python36-jinja2
                  - python36-crypto
                  - python36-leveldb
                  - python36-simplejson
                  - python36-setproctitle
                  - python36-psutil
                  - python36-PyYAML
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         -  name         : centos8
            if           : "{{variables.is_centos}} and {{collector.system.os.linux.major_version}} == 8"
            parameters   :
               packages:
                  - libgomp   # monotonic clock
                  - epel-release
                  - python3-rpm
                  - python3-jinja2
                  # python3-cryptography  # not working on centos8
                  - leveldb     # no python-leveldb for centos8
                  - python3-simplejson
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
                  # For pycrypto
                  - gcc
                  - python3-devel
            post_commands:
               - pip3 install pycrypto
         
         # The new centos 8
         -  name         : rockylinux
            if           : "{{variables.is_rocky}} and {{collector.system.os.linux.major_version}} == 8"
            parameters   :
               packages:
                  - libgomp   # monotonic clock
                  - epel-release
                  - python3-rpm
                  - python3-jinja2
                  # python3-pycryptodomex  # not the good one too
                  # python3-cryptography  # not working on centos8
                  - leveldb     # no python-leveldb for centos8
                  - python3-simplejson
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
                  # For pycrypto
                  - gcc
                  - python3-devel
            post_commands:
               - pip3 install pycrypto


         # The new centos 8 bis
         -  name         : almalinux
            if           : "{{variables.is_alma}} and {{collector.system.os.linux.major_version}} == 8"
            parameters   :
               packages:
                  - libgomp   # monotonic clock
                  - epel-release
                  - python3-rpm
                  - python3-jinja2
                  # python3-pycryptodomex  # not the good one too
                  # python3-cryptography  # not working on centos8
                  - leveldb     # no python-leveldb for centos8
                  - python3-simplejson
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
                  # For pycrypto
                  - gcc
                  - python3-devel
            post_commands:
               - pip3 install pycrypto


         -  name         : redhat8
            if           : "{{variables.is_redhat}} and {{collector.system.os.linux.major_version}} == 8"
            parameters   :
               packages:
                  #- libgomp   # monotonic clock
                  #- epel-release
                  - python3-rpm
                  - python3-jinja2
                  # python3-cryptography  # not working on centos8
                  #- leveldb     # no python-leveldb for centos8
                  #- python3-simplejson
                  #- python3-setproctitle
                  #- python3-psutil
                  - python3-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
                  # For pycrypto
                  - gcc
                  - gcc-c++
                  - python3-devel
                  - python3-cryptography
            post_commands:
               #- pip3 install pycrypto
                - pip3 install simplejson setproctitle leveldb psutil pycrypto
         
         
         -  name      : is_oracle_linux_7
            if        : "{{variables.is_oracle_linux}} and {{collector.system.os.linux.major_version}} == 7"
            parameters:
               packages:
                  - oracle-epel-release-el7  # for yaml
                  - python3-rpm
                  - python36-jinja2
                  - python3-setuptools
                  - python36-PyYAML
                  #- gcc
                  #- gcc-c++
                  #- python3-devel
                  - python36-leveldb  # in epel
                  - python36-simplejson  # in epel
                  - python36-setproctitle # in epel
                  - python36-psutil  # in epel
                  - python36-crypto  # in epel
                  - bash-completion  # Bash completion to enable the CLI completion
                  # python3-cryptography is not the valid one
            
         
         
         -  name         : is_oracle_linux_8
            if           : "{{variables.is_oracle_linux}} and {{collector.system.os.linux.major_version}} == 8"
            parameters   :
               packages:
                  - oracle-epel-release-el8  # for yaml
                  - python3-rpm
                  - python3-jinja2
                  - python3-setuptools
                  - python3-pyyaml  # in epel
                  - leveldb  # in epel
                  - python3-simplejson  # in epel
                  - python3-setproctitle # in epel
                  - python3-psutil  # in epel
                  # - python3-pycryptodomex/python3-cryptography  no valid one founded in repos
                  - gcc                # for pycrypto
                  - python3-devel      # for pycrypto
                  - bash-completion  # Bash completion to enable the CLI completion
            post_commands:
               - pip3 install pycrypto
         

         
         
         
         -  name      : debian
            if        : "{{variables.is_debian}} and system_is_python_2()"
            parameters:
               packages:
                  - python-jinja2
                  - python-crypto
                  - python-setuptools
                  - python-leveldb
                  - python-simplejson
                  - python-setproctitle
                  - python-psutil
                  - python-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         -  name      : debian_python3_10_and_less
            if        : "({{variables.is_debian}} and system_is_python_3()) and {{collector.system.os.linux.major_version}} <= 10 "
            parameters:
               packages:
                  - python3-jinja2
                  - python3-crypto
                  - python3-setuptools
                  - python3-leveldb
                  - python3-simplejson
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         # Debian 11: need python3-pycryptodome for crypto
         -  name      : debian_python3_11_and_more
            if        : "({{variables.is_debian}} and system_is_python_3()) and {{collector.system.os.linux.major_version}} >= 11"
            parameters:
               packages:
                  - python3-jinja2
                  - python3-pycryptodome
                  - python3-setuptools
                  - libleveldb1d  # no native python wrapper
                  - python3-simplejson
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         -  name      : ubuntu_python2
            if        : "{{variables.is_ubuntu}} and system_is_python_2()"
            parameters:
               packages:
                  - python-jinja2
                  - python-crypto
                  - python-setuptools
                  - python-simplejson
                  - python-setproctitle
                  - python-psutil
                  - python-leveldb
                  - python-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         -  name      : ubuntu_python3
            if        : "{{variables.is_ubuntu}} and system_is_python_3()"
            parameters:
               packages:
                  - python3-jinja2
                  - python3-crypto
                  - python3-setuptools
                  - python3-simplejson
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
                  - libleveldb1d   # no python3-leveldb, only python3-plyvel
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         ##### FEDORA:
         # there are rules for 24, 25, 26 -> 30 (python2) and 31+ (python3)
         # and So fedora 31 and more
         -  name      : fedora_python2
            if        : "{{variables.is_fedora}} and system_is_python_2()"
            parameters:
               packages:
                  - python2-rpm
                  - python-jinja2
                  - python-crypto
                  - python-simplejson
                  - python2-setproctitle
                  - python2-psutil
                  - python2-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
                  - leveldb
         
         
         ##### FEDORA:
         # there are rules for 24, 25, 26 -> 30 (python2) and 31+ (python3)
         # and So fedora 31 and more
         -  name      : fedora_python3
            if        : "{{variables.is_fedora}} and system_is_python_3()"
            parameters:
               packages:
                  - python3-rpm
                  - python3-jinja2
                  - python3-crypto
                  - python3-simplejson
                  - bash-completion  # Bash completion to enable the CLI completion
                  - python3-leveldb
                  - python3-setproctitle
                  - python3-psutil
                  - python3-yaml
         
         
         # Alpine 3.5->7+ have pip2 command
         -  name         : alpine3_5_6_7_8_9_10
            if           : "{{variables.is_alpine}} and ( {{collector.system.os.linux.minor_version}} >= 5 and {{collector.system.os.linux.minor_version}} <= 10 )"
            parameters   :
               packages:
                  - musl-dev  # monotonic clock
                  - py-jinja2
                  - py-crypto
                  - py-setuptools
                  - gcc
                  - linux-headers
                  - musl-dev
                  - libgcc
                  - libgc++
                  - g++
                  - python2-dev
                  - py2-pip
                  - py2-simplejson
                  - py2-setproctitle
                  - py2-psutil
                  - py2-yaml
                  # Bash completion to enable the CLI completion
                  - bash-completion
            post_commands:
               - pip2 install leveldb
         
         
         
         # Alpine 3.11 => for python 3
         -  name      : alpine11_py3
            if        : "{{variables.is_alpine_11}} and system_is_python_3()"
            parameters:
               packages:
                  - musl-dev  # monotonic clock
                  - py3-jinja2
                  #- py3-pycryptodome   fail on alpine 11
                  - py3-crypto
                  - py3-setuptools
                  - leveldb
                  - py3-simplejson
                  - py3-setproctitle
                  - py3-psutil
                  - py3-yaml
                  # Bash completion to enable the CLI completion
                  - bash-completion
         
         # Alpine 3.12+ => for python 3
         -  name      : alpine12_py3_and_more
            if        : "{{variables.is_alpine_12_and_more}} and system_is_python_3()"
            parameters:
               packages:
                  - musl-dev  # monotonic clock
                  - py3-jinja2
                  - py3-pycryptodome
                  #- py3-crypto  # alias to pycryptodome
                  - py3-setuptools
                  - leveldb
                  - py3-simplejson
                  - py3-setproctitle
                  - py3-psutil
                  - py3-yaml
                  # Bash completion to enable the CLI completion
                  - bash-completion
         
         
         # Open suse 15 have specific packages names
         -  name      : opensuse_15
            if        : "{{variables.is_opensuse}} and {{collector.system.os.linux.major_version}} == 15"
            parameters:
               packages:
                  - python2-rpm
                  - python2-Jinja2
                  - python2-pycrypto
                  - python2-simplejson
                  - python2-setuptools
                  - python2-leveldb
                  - bash-completion  # Bash completion to enable the CLI completion
                  - python2-psutil
                  - python2-setproctitle
                  - python2-pyaml
         
         
         # Older open source (42.x)
         -  name      : opensuse
            if        : "{{variables.is_opensuse}}"
            parameters:
               packages:
                  - rpm-python
                  - python-Jinja2
                  - python-pycrypto
                  - python-simplejson
                  - python-setuptools
                  - python-leveldb
                  - python-psutil
                  - python-setproctitle
                  - python-yaml
                  - bash-completion  # Bash completion to enable the CLI completion
         
         
         -  name         : amazon_linux
            if           : "{{variables.is_amazon_linux}}"
            parameters   :
               packages:
                  - python27-setuptools
                  - python-jinja2
                  - python27-crypto
                  - python27-simplejson
                  - gcc
                  - gcc-c++
                  - python27-devel
                  - python27-pip
                  - python27-simplejson
                  - python27-PyYAML
                  # No Bash completion for amazon linux
            post_commands:
               - pip install leveldb psutil setproctitle
         
         
         # old versinon of amazonlinux2
         -  name         : amazon_linux2
            if           : "{{variables.is_amazon_linux2}}"
            parameters   :
               packages:
                  - python2-setuptools
                  - python-jinja2
                  # python2-cryptography # Not with amazon
                  - python-simplejson
                  - gcc
                  - gcc-c++
                  - python-devel
                  - python2-pip
                  - python-setproctitle
                  - python-yaml
                  - bash-completion
            post_commands:
               - pip install leveldb psutil pycrypto


         # new amazonlinux2, 2022 edition, with python3 + fedora based
         -  name         : amazon_linux2022
            if           : "{{variables.is_amazon_linux2022}}"
            parameters   :
               packages:
                  - python3-rpm
                  - python3-jinja2
                  - python3-crypto
                  - bash-completion  # Bash completion to enable the CLI completion
                  - python3-setproctitle
                  - python3-psutil
                  - python3-pyyaml
                  # For leveldb: need to go with pip
                  - python3-pip
                  - gcc
                  - gcc-c++
                  - python3-setuptools
                  - python3-devel
            post_commands:
               - pip install simplejson leveldb

