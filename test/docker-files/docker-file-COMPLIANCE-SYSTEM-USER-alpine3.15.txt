FROM       alpine:3.15
MAINTAINER Jean Gabes <naparuba@gmail.com>


ADD        test/docker-helper/  /
RUN        /apk_add bash
# Alpine 3.11+ do not have any more py2-jinja2, so directly go to python3
RUN        /apk_add python3

# Tests with , we are giving the test it's path for starting the setup.py
ENV        PYTHON_EXE=/usr/bin/python3


ADD        . /root/opsbro-oss
WORKDIR    /root/opsbro-oss

RUN        $PYTHON_EXE setup.py install

# Copy the mail pack into a local one to enable modification
RUN        opsbro  packs overload global.linux
# Copy the new compliance value
ADD        test/test-files/test-compliance-system-user/compliance/*.yml   /var/lib/opsbro/local-configuration/packs/linux/compliance/

ENTRYPOINT     test/test_compliance-system-user.sh
