FROM       rockylinux/rockylinux:8.4
MAINTAINER Jean Gabes <naparuba@gmail.com>

ADD        test/docker-helper/  /


RUN        /yum_install  python3

# For faster re-test/debug launch, copy from install.yaml part rocky8
RUN        /yum_install  libgomp   # monotonic clock
RUN        /yum_install  epel-release
RUN        /yum_install  python3-rpm
RUN        /yum_install  python3-jinja2
RUN        /yum_install  leveldb     # no python-leveldb for centos8
RUN        /yum_install  python3-simplejson
RUN        /yum_install  python3-setproctitle
RUN        /yum_install  python3-psutil
RUN        /yum_install  python3-yaml
RUN        /yum_install  bash-completion  # Bash completion to enable the CLI completion
RUN        /yum_install  gcc
RUN        /yum_install  python3-devel


# As there is no "python" in centos8, we are giving the test it's path for starting the setup.py
ENV        PYTHON_EXE=/usr/bin/python3

# DNS: need dig
RUN        /yum_install  bind-utils
# Netstat
RUN        /yum_install  net-tools

ADD        . /root/opsbro-oss


WORKDIR    /root/opsbro-oss

RUN        python3 setup.py install


ENTRYPOINT     test/test_module_dns.sh
