FROM centos:8
MAINTAINER Jean Gabes <naparuba@gmail.com>

ADD        test/docker-helper/  /

# Fix: archived centos8, RIP
RUN        sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-Linux-*
RUN        sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.epel.cloud|g' /etc/yum.repos.d/CentOS-Linux-*

RUN        /yum_install  python3

# As there is no "python" in centos8, we are giving the test it's path for starting the setup.py
ENV        PYTHON_EXE=/usr/bin/python3



# TCL: very little
ENV        TEST_PACKAGE_NAME=tcl
# centos have a virtual package to test, vi -> vim-minimal
ENV        TEST_PACKAGE_NAME_VIRTUAL=vi
# But need to delete it first as it is installed by default
RUN        /yum_remove vim-minimal

# For the test
RUN        /yum_install   procps

ADD        . /root/opsbro-oss

WORKDIR    /root/opsbro-oss


# TCL: very little
ENV        TEST_PACKAGE_NAME=tcl
ENTRYPOINT        test/test_one_linux_installation.sh  && test/assert_group.sh "centos"


